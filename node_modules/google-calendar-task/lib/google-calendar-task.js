var gcal = require('google-calendar');
var email = require('../../sendgrid_email.js');


exports.addTask = function (accessToken) {
	var google_calendar = new gcal.GoogleCalendar(accessToken);
	google_calendar.calendarList.list(function(err, calendarList) {
		if (err) {
			console.log(err);
		} else {
			//console.log(calendarList);
		}
		var calendarId = calendarList.items[0].id;
		google_calendar.events.list(calendarId, function(err, eventList) {
			if (err) {
				console.log(err);
			} else {
				for (var i = 0; i < eventList.items.length; i++){
					//console.log(eventList.items[i].start);
					//console.log(eventList.items[i].end)
				}
			}
		});
		var newEvent = {
		  	"kind": "calendar#event",
  			"status": 'confirmed',
  			"summary": 'New Event', // title
  			"description": 'This is a new test event', // description
  			"location": 'Engineering', // location
  			"start": {
    			dateTime: '2014-09-13T23:00:00-04:00',
       			timeZone: 'America/New_York'
  			},
  			"end": {
    			dateTime: '2014-09-13T23:30:00-04:00',
       			timeZone: 'America/New_York'
  			},
		};
		google_calendar.events.insert(calendarId, newEvent, function(err, savedEvent){
			if (err){
				console.log(err);
			}
			else {
				//console.log(savedEvent);
				console.log(savedEvent.creator.email);
				email.sendConflictEmail(savedEvent);

			}
		});
	});

};